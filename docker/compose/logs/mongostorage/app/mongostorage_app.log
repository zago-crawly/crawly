2023-07-12 17:00:35.812 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 17:05:13.972 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 17:05:22.542 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 17:05:28.613 ERROR    :: Unexpected connection close from remote "amqp://crwl:******@rabbitmq:5672/", Connection.Close(reply_code=320, reply_text="CONNECTION_FORCED - broker forced connection closure with reason 'shutdown'")
NoneType: None
2023-07-12 17:05:28.678 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-07-12 17:07:51.761 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 17:08:01.775 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 17:27:38.488 ERROR    :: Exception in callback _task_done(<Task finishe...e '_create'")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43
handle: <Handle _task_done(<Task finishe...e '_create'")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43>
Traceback (most recent call last):

  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 633, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x4002b3ca60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 600, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x4002b3e560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 1896, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x4002a95fc0>
    └ <Handle _task_done(<Task finishe...e '_create'")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
> File "/usr/local/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle _task_done(<Task finishe...e '_create'")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle _task_done(<Task finishe...e '_create'")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle _task_done(<Task finishe...e '_create'")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py", line 47, in _task_done
    raise exc
          └ AttributeError("'MongostorageApp' object has no attribute '_create'")

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._create(mes)
                │            └ {'action': 'read', 'collection_id': 'new_test_collection', 'item_id': 0, 'skip': 10, 'limit': None}
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

AttributeError: 'MongostorageApp' object has no attribute '_create'
2023-07-12 17:27:38.538 ERROR    :: Task exception was never retrieved
future: <Task finished name='Task-58' coro=<consumer() done, defined at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py:31> exception=AttributeError("'MongostorageApp' object has no attribute '_create'")>
Traceback (most recent call last):

> File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py", line 37, in consumer
    return await create_task(callback, message)
                 │           │         └ IncomingMessage:{'app_id': None,
                 │           │            'body_size': 99,
                 │           │            'cluster_id': '',
                 │           │            'consumer_tag': 'ctag1.860b1a6c23284c319ab2ea75b963bfd...
                 │           └ <bound method MongostorageApp._process_message of <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>>
                 └ <function create_task at 0x40031d48b0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._create(mes)
                │            └ {'action': 'read', 'collection_id': 'new_test_collection', 'item_id': 0, 'skip': 10, 'limit': None}
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

AttributeError: 'MongostorageApp' object has no attribute '_create'
2023-07-12 17:28:27.107 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 17:28:35.707 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 17:29:46.297 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 17:29:55.741 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 17:33:04.253 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 17:33:12.804 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 17:36:22.684 INFO     :: new_test_collection
2023-07-12 17:36:22.738 ERROR    :: Exception in callback _task_done(<Task finishe...uthorized'}")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43
handle: <Handle _task_done(<Task finishe...uthorized'}")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43>
Traceback (most recent call last):

  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 633, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x4002b3caf0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 600, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x4002b3e5f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 1896, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x4002a96050>
    └ <Handle _task_done(<Task finishe...uthorized'}")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
> File "/usr/local/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle _task_done(<Task finishe...uthorized'}")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle _task_done(<Task finishe...uthorized'}")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle _task_done(<Task finishe...uthorized'}")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py", line 47, in _task_done
    raise exc
          └ OperationFailure("command find requires authentication, full error: {'ok': 0.0, 'errmsg': 'command find requires authenticati...

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'new_test_collection', 'item_id': '64aee16d4441251e99c74326', 'skip': 0, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046de5f0>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 104, in _read
    document = await db[collection_id].find_one({'_id': item_id})
                     │  │                               └ '64aee16d4441251e99c74326'
                     │  └ 'new_test_collection'
                     └ AsyncIOMotorDatabase(Database(MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=False, driver=...

  File "/usr/local/lib/python3.10/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             │        │            └ None
             │        └ None
             └ None
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/collection.py", line 1470, in find_one
    for result in cursor.limit(-1):
                  │      └ <function Cursor.limit at 0x40033f9e10>
                  └ <pymongo.cursor.Cursor object at 0x4004729810>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1251, in next
    if len(self.__data) or self._refresh():
           │               │    └ <function Cursor._refresh at 0x40033fa950>
           │               └ <pymongo.cursor.Cursor object at 0x4004729810>
           └ <pymongo.cursor.Cursor object at 0x4004729810>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1168, in _refresh
    self.__send_message(q)
    │                   └ <pymongo.message._Query object at 0x4004486b90>
    └ <pymongo.cursor.Cursor object at 0x4004729810>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1055, in __send_message
    response = client._run_operation(
               │      └ <function MongoClient._run_operation at 0x400365e440>
               └ MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', versi...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/_csot.py", line 106, in csot_wrapper
    return func(self, *args, **kwargs)
           │    │      │       └ {'address': None}
           │    │      └ (<pymongo.message._Query object at 0x4004486b90>, <bound method Cursor._unpack_response of <pymongo.cursor.Cursor object at 0...
           │    └ MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', versi...
           └ <function MongoClient._run_operation at 0x400365e3b0>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1341, in _run_operation
    return self._retryable_read(
           │    └ <function MongoClient._retryable_read at 0x400365e710>
           └ MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', versi...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/_csot.py", line 106, in csot_wrapper
    return func(self, *args, **kwargs)
           │    │      │       └ {'address': None, 'retryable': True}
           │    │      └ (<function MongoClient._run_operation.<locals>._cmd at 0x4004733910>, Primary(), <pymongo.client_session.ClientSession object...
           │    └ MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', versi...
           └ <function MongoClient._retryable_read at 0x400365e680>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1465, in _retryable_read
    return func(session, server, sock_info, read_pref)
           │    │        │       │          └ Primary()
           │    │        │       └ SocketInfo(<socket.socket fd=24, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.18.0.2', 490...
           │    │        └ <Server <ServerDescription ('mongodb', 27017) server_type: Standalone, rtt: 0.005055667001215625>>
           │    └ <pymongo.client_session.ClientSession object at 0x4004762500>
           └ <function MongoClient._run_operation.<locals>._cmd at 0x4004733910>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1337, in _cmd
    return server.run_operation(
           │      └ <function _handle_reauth.<locals>.inner at 0x4003647640>
           └ <Server <ServerDescription ('mongodb', 27017) server_type: Standalone, rtt: 0.005055667001215625>>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/helpers.py", line 279, in inner
    return func(*args, **kwargs)
           │     │       └ {}
           │     └ (<Server <ServerDescription ('mongodb', 27017) server_type: Standalone, rtt: 0.005055667001215625>>, SocketInfo(<socket.socke...
           └ <function Server.run_operation at 0x40036475b0>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/server.py", line 135, in run_operation
    _check_command_response(first, sock_info.max_wire_version)
    │                       │      │         └ 17
    │                       │      └ SocketInfo(<socket.socket fd=24, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.18.0.2', 490...
    │                       └ {'ok': 0.0, 'errmsg': 'command find requires authentication', 'code': 13, 'codeName': 'Unauthorized'}
    └ <function _check_command_response at 0x40033ac820>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/helpers.py", line 194, in _check_command_response
    raise OperationFailure(errmsg, code, response, max_wire_version)
          │                │       │     │         └ 17
          │                │       │     └ {'ok': 0.0, 'errmsg': 'command find requires authentication', 'code': 13, 'codeName': 'Unauthorized'}
          │                │       └ 13
          │                └ 'command find requires authentication'
          └ <class 'pymongo.errors.OperationFailure'>

pymongo.errors.OperationFailure: command find requires authentication, full error: {'ok': 0.0, 'errmsg': 'command find requires authentication', 'code': 13, 'codeName': 'Unauthorized'}
2023-07-12 17:36:22.802 ERROR    :: Task exception was never retrieved
future: <Task finished name='Task-25' coro=<consumer() done, defined at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py:31> exception=OperationFailure("command find requires authentication, full error: {'ok': 0.0, 'errmsg': 'command find requires authentication', 'code': 13, 'codeName': 'Unauthorized'}")>
Traceback (most recent call last):

> File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py", line 37, in consumer
    return await create_task(callback, message)
                 │           │         └ IncomingMessage:{'app_id': None,
                 │           │            'body_size': 123,
                 │           │            'cluster_id': '',
                 │           │            'consumer_tag': 'ctag1.f65669894eab4ed39d1273a0da58cf...
                 │           └ <bound method MongostorageApp._process_message of <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>>
                 └ <function create_task at 0x40031d4940>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'new_test_collection', 'item_id': '64aee16d4441251e99c74326', 'skip': 0, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046de5f0>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 104, in _read
    document = await db[collection_id].find_one({'_id': item_id})
                     │  │                               └ '64aee16d4441251e99c74326'
                     │  └ 'new_test_collection'
                     └ AsyncIOMotorDatabase(Database(MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=False, driver=...

  File "/usr/local/lib/python3.10/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             │        │            └ None
             │        └ None
             └ None
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/collection.py", line 1470, in find_one
    for result in cursor.limit(-1):
                  │      └ <function Cursor.limit at 0x40033f9e10>
                  └ <pymongo.cursor.Cursor object at 0x4004729810>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1251, in next
    if len(self.__data) or self._refresh():
           │               │    └ <function Cursor._refresh at 0x40033fa950>
           │               └ <pymongo.cursor.Cursor object at 0x4004729810>
           └ <pymongo.cursor.Cursor object at 0x4004729810>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1168, in _refresh
    self.__send_message(q)
    │                   └ <pymongo.message._Query object at 0x4004486b90>
    └ <pymongo.cursor.Cursor object at 0x4004729810>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1055, in __send_message
    response = client._run_operation(
               │      └ <function MongoClient._run_operation at 0x400365e440>
               └ MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', versi...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/_csot.py", line 106, in csot_wrapper
    return func(self, *args, **kwargs)
           │    │      │       └ {'address': None}
           │    │      └ (<pymongo.message._Query object at 0x4004486b90>, <bound method Cursor._unpack_response of <pymongo.cursor.Cursor object at 0...
           │    └ MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', versi...
           └ <function MongoClient._run_operation at 0x400365e3b0>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1341, in _run_operation
    return self._retryable_read(
           │    └ <function MongoClient._retryable_read at 0x400365e710>
           └ MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', versi...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/_csot.py", line 106, in csot_wrapper
    return func(self, *args, **kwargs)
           │    │      │       └ {'address': None, 'retryable': True}
           │    │      └ (<function MongoClient._run_operation.<locals>._cmd at 0x4004733910>, Primary(), <pymongo.client_session.ClientSession object...
           │    └ MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', versi...
           └ <function MongoClient._retryable_read at 0x400365e680>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1465, in _retryable_read
    return func(session, server, sock_info, read_pref)
           │    │        │       │          └ Primary()
           │    │        │       └ SocketInfo(<socket.socket fd=24, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.18.0.2', 490...
           │    │        └ <Server <ServerDescription ('mongodb', 27017) server_type: Standalone, rtt: 0.005055667001215625>>
           │    └ <pymongo.client_session.ClientSession object at 0x4004762500>
           └ <function MongoClient._run_operation.<locals>._cmd at 0x4004733910>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1337, in _cmd
    return server.run_operation(
           │      └ <function _handle_reauth.<locals>.inner at 0x4003647640>
           └ <Server <ServerDescription ('mongodb', 27017) server_type: Standalone, rtt: 0.005055667001215625>>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/helpers.py", line 279, in inner
    return func(*args, **kwargs)
           │     │       └ {}
           │     └ (<Server <ServerDescription ('mongodb', 27017) server_type: Standalone, rtt: 0.005055667001215625>>, SocketInfo(<socket.socke...
           └ <function Server.run_operation at 0x40036475b0>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/server.py", line 135, in run_operation
    _check_command_response(first, sock_info.max_wire_version)
    │                       │      │         └ 17
    │                       │      └ SocketInfo(<socket.socket fd=24, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.18.0.2', 490...
    │                       └ {'ok': 0.0, 'errmsg': 'command find requires authentication', 'code': 13, 'codeName': 'Unauthorized'}
    └ <function _check_command_response at 0x40033ac820>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/helpers.py", line 194, in _check_command_response
    raise OperationFailure(errmsg, code, response, max_wire_version)
          │                │       │     │         └ 17
          │                │       │     └ {'ok': 0.0, 'errmsg': 'command find requires authentication', 'code': 13, 'codeName': 'Unauthorized'}
          │                │       └ 13
          │                └ 'command find requires authentication'
          └ <class 'pymongo.errors.OperationFailure'>

pymongo.errors.OperationFailure: command find requires authentication, full error: {'ok': 0.0, 'errmsg': 'command find requires authentication', 'code': 13, 'codeName': 'Unauthorized'}
2023-07-12 17:42:20.420 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 17:42:28.868 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 17:42:49.840 INFO     :: new_test_collection
2023-07-12 17:43:03.502 INFO     :: new_test_collection
2023-07-12 20:15:07.859 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:15:16.382 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:15:23.665 INFO     :: new_test_collection
2023-07-12 20:15:39.121 INFO     :: new_test_collection
2023-07-12 20:15:43.608 INFO     :: new_test_collection
2023-07-12 20:15:46.187 INFO     :: new_test_collection
2023-07-12 20:16:18.202 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:16:26.673 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:16:40.609 INFO     :: new_test_collection
2023-07-12 20:16:40.787 INFO     :: None
2023-07-12 20:17:52.993 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:18:01.509 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:18:05.003 INFO     :: new_test_collection
2023-07-12 20:18:11.402 INFO     :: new_test_collection
2023-07-12 20:18:43.018 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:18:51.631 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:19:06.928 INFO     :: new_test_collection
2023-07-12 20:19:26.489 INFO     :: new_test_collection
2023-07-12 20:20:11.047 ERROR    :: Unexpected connection close from remote "amqp://crwl:******@rabbitmq:5672/", Connection.Close(reply_code=320, reply_text="CONNECTION_FORCED - broker forced connection closure with reason 'shutdown'")
NoneType: None
2023-07-12 20:20:11.086 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-07-12 20:20:47.833 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:20:56.511 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:21:13.805 INFO     :: new_test_collection
2023-07-12 20:24:34.597 INFO     :: new_test_collection
2023-07-12 20:26:25.334 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:26:33.795 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:26:46.322 INFO     :: {'action': 'read', 'collection_id': 'new_test_collection', 'item_id': '64aee16d4441251e99c74326', 'skip': 0, 'limit': None}
2023-07-12 20:26:46.326 INFO     :: new_test_collection
2023-07-12 20:26:46.499 INFO     :: None
2023-07-12 20:27:55.812 INFO     :: {'action': 'read', 'collection_id': 'new_test_collection', 'item_id': 0, 'skip': 10, 'limit': None}
2023-07-12 20:27:55.817 INFO     :: new_test_collection
2023-07-12 20:29:30.901 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:29:39.309 INFO     :: Связь с AMQP сервером установлена.
2023-07-12 20:29:45.843 INFO     :: new_test_collection
2023-07-12 20:29:45.848 INFO     :: ITEM_ID 0
2023-07-12 20:30:44.684 INFO     :: new_test_collection
2023-07-12 20:30:44.687 INFO     :: ITEM_ID 64aee16d4441251e99c74326
2023-07-12 20:30:44.870 INFO     :: None
2023-07-21 15:40:42.500 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 15:40:53.244 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 15:47:03.290 INFO     :: test_collection
2023-07-21 15:47:03.296 INFO     :: ITEM_ID 64baa845442a2a29b3ee5553
2023-07-21 15:47:03.488 INFO     :: None
2023-07-21 15:47:34.437 INFO     :: test_collection
2023-07-21 15:47:34.441 INFO     :: ITEM_ID 64baa845442a2a29b3ee5551
2023-07-21 15:47:34.452 INFO     :: None
2023-07-21 15:49:23.432 INFO     :: test_collection
2023-07-21 15:49:23.436 INFO     :: ITEM_ID 64baa845442a2a29b3ee5551
2023-07-21 15:49:23.448 INFO     :: None
2023-07-21 15:49:56.599 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 15:50:05.518 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 15:50:05.574 INFO     :: test_collection
2023-07-21 15:50:05.577 INFO     :: ITEM_ID 64baa845442a2a29b3ee5551
2023-07-21 15:50:05.751 INFO     :: None
2023-07-21 15:55:43.771 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 15:55:52.368 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 15:55:55.003 INFO     :: test_collection
2023-07-21 15:55:55.006 INFO     :: ITEM_ID 64baa845442a2a29b3ee5551
2023-07-21 15:56:14.989 INFO     :: test_collection
2023-07-21 15:56:14.992 INFO     :: ITEM_ID 64baa845442a2a29b3ee5551
2023-07-21 15:56:25.514 ERROR    :: Exception in callback _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43
handle: <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43>
Traceback (most recent call last):

  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 633, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x4002b3ca60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 600, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x4002b3e560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 1896, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x4002a95fc0>
    └ <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
> File "/usr/local/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py", line 47, in _task_done
    raise exc
          └ ServerSelectionTimeoutError("localhost:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDe...

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': '64baa845442a2a29b3ee5551', 'skip': 0, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046d64d0>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 105, in _read
    document = await db[collection_id].find_one({'_id': item_id})
                     │  │                               └ '64baa845442a2a29b3ee5551'
                     │  └ 'test_collection'
                     └ AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, drive...

  File "/usr/local/lib/python3.10/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             │        │            └ None
             │        └ None
             └ None
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/collection.py", line 1470, in find_one
    for result in cursor.limit(-1):
                  │      └ <function Cursor.limit at 0x40033fdd80>
                  └ <pymongo.cursor.Cursor object at 0x4004703190>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1251, in next
    if len(self.__data) or self._refresh():
           │               │    └ <function Cursor._refresh at 0x40033fe8c0>
           │               └ <pymongo.cursor.Cursor object at 0x4004703190>
           └ <pymongo.cursor.Cursor object at 0x4004703190>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1142, in _refresh
    self.__session = self.__collection.database.client._ensure_session()
    │                └ <pymongo.cursor.Cursor object at 0x4004703190>
    └ <pymongo.cursor.Cursor object at 0x4004703190>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1758, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
           └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', ver...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1703, in __start_session
    self._topology._check_implicit_session_support()
    │    │         └ <function Topology._check_implicit_session_support at 0x400365c940>
    │    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
    └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', ver...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 538, in _check_implicit_session_support
    self._check_session_support()
    │    └ <function Topology._check_session_support at 0x400365c9d0>
    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 554, in _check_session_support
    self._select_servers_loop(
    │    └ <function Topology._select_servers_loop at 0x400364bbe0>
    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 238, in _select_servers_loop
    raise ServerSelectionTimeoutError(
          └ <class 'pymongo.errors.ServerSelectionTimeoutError'>

pymongo.errors.ServerSelectionTimeoutError: localhost:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [Errno 111] Connection refused')>]>
2023-07-21 15:56:25.594 ERROR    :: Task exception was never retrieved
future: <Task finished name='Task-19' coro=<consumer() done, defined at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py:31> exception=ServerSelectionTimeoutError("localhost:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [Errno 111] Connection refused')>]>")>
Traceback (most recent call last):

> File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py", line 37, in consumer
    return await create_task(callback, message)
                 │           │         └ IncomingMessage:{'app_id': None,
                 │           │            'body_size': 119,
                 │           │            'cluster_id': '',
                 │           │            'consumer_tag': 'ctag1.eb32bf33d8474d8aa107523d526951...
                 │           └ <bound method MongostorageApp._process_message of <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>>
                 └ <function create_task at 0x40031d48b0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': '64baa845442a2a29b3ee5551', 'skip': 0, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046d64d0>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 105, in _read
    document = await db[collection_id].find_one({'_id': item_id})
                     │  │                               └ '64baa845442a2a29b3ee5551'
                     │  └ 'test_collection'
                     └ AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, drive...

  File "/usr/local/lib/python3.10/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             │        │            └ None
             │        └ None
             └ None
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/collection.py", line 1470, in find_one
    for result in cursor.limit(-1):
                  │      └ <function Cursor.limit at 0x40033fdd80>
                  └ <pymongo.cursor.Cursor object at 0x4004703190>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1251, in next
    if len(self.__data) or self._refresh():
           │               │    └ <function Cursor._refresh at 0x40033fe8c0>
           │               └ <pymongo.cursor.Cursor object at 0x4004703190>
           └ <pymongo.cursor.Cursor object at 0x4004703190>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1142, in _refresh
    self.__session = self.__collection.database.client._ensure_session()
    │                └ <pymongo.cursor.Cursor object at 0x4004703190>
    └ <pymongo.cursor.Cursor object at 0x4004703190>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1758, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
           └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', ver...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1703, in __start_session
    self._topology._check_implicit_session_support()
    │    │         └ <function Topology._check_implicit_session_support at 0x400365c940>
    │    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
    └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', ver...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 538, in _check_implicit_session_support
    self._check_session_support()
    │    └ <function Topology._check_session_support at 0x400365c9d0>
    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 554, in _check_session_support
    self._select_servers_loop(
    │    └ <function Topology._select_servers_loop at 0x400364bbe0>
    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 238, in _select_servers_loop
    raise ServerSelectionTimeoutError(
          └ <class 'pymongo.errors.ServerSelectionTimeoutError'>

pymongo.errors.ServerSelectionTimeoutError: localhost:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [Errno 111] Connection refused')>]>
2023-07-21 15:56:27.297 INFO     :: test_collection
2023-07-21 15:56:27.300 INFO     :: ITEM_ID 64baa845442a2a29b3ee5551
2023-07-21 15:56:45.398 ERROR    :: Exception in callback _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43
handle: <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43>
Traceback (most recent call last):

  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 633, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x4002b3ca60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 600, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x4002b3e560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 1896, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x4002a95fc0>
    └ <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
> File "/usr/local/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py", line 47, in _task_done
    raise exc
          └ ServerSelectionTimeoutError("localhost:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDe...

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': '64baa845442a2a29b3ee5551', 'skip': 0, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046d64d0>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 105, in _read
    document = await db[collection_id].find_one({'_id': item_id})
                     │  │                               └ '64baa845442a2a29b3ee5551'
                     │  └ 'test_collection'
                     └ AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, drive...

  File "/usr/local/lib/python3.10/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             │        │            └ None
             │        └ None
             └ None
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/collection.py", line 1470, in find_one
    for result in cursor.limit(-1):
                  │      └ <function Cursor.limit at 0x40033fdd80>
                  └ <pymongo.cursor.Cursor object at 0x400476dde0>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1251, in next
    if len(self.__data) or self._refresh():
           │               │    └ <function Cursor._refresh at 0x40033fe8c0>
           │               └ <pymongo.cursor.Cursor object at 0x400476dde0>
           └ <pymongo.cursor.Cursor object at 0x400476dde0>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1142, in _refresh
    self.__session = self.__collection.database.client._ensure_session()
    │                └ <pymongo.cursor.Cursor object at 0x400476dde0>
    └ <pymongo.cursor.Cursor object at 0x400476dde0>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1758, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
           └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', ver...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1703, in __start_session
    self._topology._check_implicit_session_support()
    │    │         └ <function Topology._check_implicit_session_support at 0x400365c940>
    │    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
    └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', ver...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 538, in _check_implicit_session_support
    self._check_session_support()
    │    └ <function Topology._check_session_support at 0x400365c9d0>
    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 554, in _check_session_support
    self._select_servers_loop(
    │    └ <function Topology._select_servers_loop at 0x400364bbe0>
    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 238, in _select_servers_loop
    raise ServerSelectionTimeoutError(
          └ <class 'pymongo.errors.ServerSelectionTimeoutError'>

pymongo.errors.ServerSelectionTimeoutError: localhost:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [Errno 111] Connection refused')>]>
2023-07-21 15:56:45.451 ERROR    :: Task exception was never retrieved
future: <Task finished name='Task-21' coro=<consumer() done, defined at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py:31> exception=ServerSelectionTimeoutError("localhost:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [Errno 111] Connection refused')>]>")>
Traceback (most recent call last):

> File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py", line 37, in consumer
    return await create_task(callback, message)
                 │           │         └ IncomingMessage:{'app_id': None,
                 │           │            'body_size': 119,
                 │           │            'cluster_id': '',
                 │           │            'consumer_tag': 'ctag1.eb32bf33d8474d8aa107523d526951...
                 │           └ <bound method MongostorageApp._process_message of <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>>
                 └ <function create_task at 0x40031d48b0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': '64baa845442a2a29b3ee5551', 'skip': 0, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046d64d0>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 105, in _read
    document = await db[collection_id].find_one({'_id': item_id})
                     │  │                               └ '64baa845442a2a29b3ee5551'
                     │  └ 'test_collection'
                     └ AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, drive...

  File "/usr/local/lib/python3.10/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             │        │            └ None
             │        └ None
             └ None
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/collection.py", line 1470, in find_one
    for result in cursor.limit(-1):
                  │      └ <function Cursor.limit at 0x40033fdd80>
                  └ <pymongo.cursor.Cursor object at 0x400476dde0>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1251, in next
    if len(self.__data) or self._refresh():
           │               │    └ <function Cursor._refresh at 0x40033fe8c0>
           │               └ <pymongo.cursor.Cursor object at 0x400476dde0>
           └ <pymongo.cursor.Cursor object at 0x400476dde0>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1142, in _refresh
    self.__session = self.__collection.database.client._ensure_session()
    │                └ <pymongo.cursor.Cursor object at 0x400476dde0>
    └ <pymongo.cursor.Cursor object at 0x400476dde0>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1758, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
           └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', ver...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1703, in __start_session
    self._topology._check_implicit_session_support()
    │    │         └ <function Topology._check_implicit_session_support at 0x400365c940>
    │    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
    └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', ver...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 538, in _check_implicit_session_support
    self._check_session_support()
    │    └ <function Topology._check_session_support at 0x400365c9d0>
    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 554, in _check_session_support
    self._select_servers_loop(
    │    └ <function Topology._select_servers_loop at 0x400364bbe0>
    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 238, in _select_servers_loop
    raise ServerSelectionTimeoutError(
          └ <class 'pymongo.errors.ServerSelectionTimeoutError'>

pymongo.errors.ServerSelectionTimeoutError: localhost:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [Errno 111] Connection refused')>]>
2023-07-21 15:56:57.665 ERROR    :: Exception in callback _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43
handle: <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43>
Traceback (most recent call last):

  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 633, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x4002b3ca60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 600, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x4002b3e560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 1896, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x4002a95fc0>
    └ <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
> File "/usr/local/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle _task_done(<Task finishe...efused')>]>")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py", line 47, in _task_done
    raise exc
          └ ServerSelectionTimeoutError("localhost:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDe...

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': '64baa845442a2a29b3ee5551', 'skip': 0, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046d64d0>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 105, in _read
    document = await db[collection_id].find_one({'_id': item_id})
                     │  │                               └ '64baa845442a2a29b3ee5551'
                     │  └ 'test_collection'
                     └ AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, drive...

  File "/usr/local/lib/python3.10/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             │        │            └ None
             │        └ None
             └ None
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/collection.py", line 1470, in find_one
    for result in cursor.limit(-1):
                  │      └ <function Cursor.limit at 0x40033fdd80>
                  └ <pymongo.cursor.Cursor object at 0x4004702800>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1251, in next
    if len(self.__data) or self._refresh():
           │               │    └ <function Cursor._refresh at 0x40033fe8c0>
           │               └ <pymongo.cursor.Cursor object at 0x4004702800>
           └ <pymongo.cursor.Cursor object at 0x4004702800>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1142, in _refresh
    self.__session = self.__collection.database.client._ensure_session()
    │                └ <pymongo.cursor.Cursor object at 0x4004702800>
    └ <pymongo.cursor.Cursor object at 0x4004702800>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1758, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
           └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', ver...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1703, in __start_session
    self._topology._check_implicit_session_support()
    │    │         └ <function Topology._check_implicit_session_support at 0x400365c940>
    │    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
    └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', ver...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 538, in _check_implicit_session_support
    self._check_session_support()
    │    └ <function Topology._check_session_support at 0x400365c9d0>
    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 554, in _check_session_support
    self._select_servers_loop(
    │    └ <function Topology._select_servers_loop at 0x400364bbe0>
    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 238, in _select_servers_loop
    raise ServerSelectionTimeoutError(
          └ <class 'pymongo.errors.ServerSelectionTimeoutError'>

pymongo.errors.ServerSelectionTimeoutError: localhost:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [Errno 111] Connection refused')>]>
2023-07-21 15:56:57.717 ERROR    :: Task exception was never retrieved
future: <Task finished name='Task-24' coro=<consumer() done, defined at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py:31> exception=ServerSelectionTimeoutError("localhost:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [Errno 111] Connection refused')>]>")>
Traceback (most recent call last):

> File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py", line 37, in consumer
    return await create_task(callback, message)
                 │           │         └ IncomingMessage:{'app_id': None,
                 │           │            'body_size': 119,
                 │           │            'cluster_id': '',
                 │           │            'consumer_tag': 'ctag1.eb32bf33d8474d8aa107523d526951...
                 │           └ <bound method MongostorageApp._process_message of <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>>
                 └ <function create_task at 0x40031d48b0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': '64baa845442a2a29b3ee5551', 'skip': 0, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046d64d0>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 105, in _read
    document = await db[collection_id].find_one({'_id': item_id})
                     │  │                               └ '64baa845442a2a29b3ee5551'
                     │  └ 'test_collection'
                     └ AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, drive...

  File "/usr/local/lib/python3.10/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             │        │            └ None
             │        └ None
             └ None
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/collection.py", line 1470, in find_one
    for result in cursor.limit(-1):
                  │      └ <function Cursor.limit at 0x40033fdd80>
                  └ <pymongo.cursor.Cursor object at 0x4004702800>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1251, in next
    if len(self.__data) or self._refresh():
           │               │    └ <function Cursor._refresh at 0x40033fe8c0>
           │               └ <pymongo.cursor.Cursor object at 0x4004702800>
           └ <pymongo.cursor.Cursor object at 0x4004702800>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/cursor.py", line 1142, in _refresh
    self.__session = self.__collection.database.client._ensure_session()
    │                └ <pymongo.cursor.Cursor object at 0x4004702800>
    └ <pymongo.cursor.Cursor object at 0x4004702800>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1758, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
           └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', ver...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/mongo_client.py", line 1703, in __start_session
    self._topology._check_implicit_session_support()
    │    │         └ <function Topology._check_implicit_session_support at 0x400365c940>
    │    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
    └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', ver...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 538, in _check_implicit_session_support
    self._check_session_support()
    │    └ <function Topology._check_session_support at 0x400365c9d0>
    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 554, in _check_session_support
    self._select_servers_loop(
    │    └ <function Topology._select_servers_loop at 0x400364bbe0>
    └ <Topology <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/pymongo/topology.py", line 238, in _select_servers_loop
    raise ServerSelectionTimeoutError(
          └ <class 'pymongo.errors.ServerSelectionTimeoutError'>

pymongo.errors.ServerSelectionTimeoutError: localhost:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 64baaa88e2ec0d59b296af01, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [Errno 111] Connection refused')>]>
2023-07-21 15:57:52.729 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 15:58:01.381 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 15:58:15.930 INFO     :: test_collection
2023-07-21 15:58:15.933 INFO     :: ITEM_ID 64baa845442a2a29b3ee5551
2023-07-21 15:58:16.114 INFO     :: None
2023-07-21 16:03:25.818 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:03:34.370 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:03:58.406 INFO     :: test_collection
2023-07-21 16:03:58.411 INFO     :: ITEM_ID 0
2023-07-21 16:05:00.618 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:05:09.190 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:05:21.220 INFO     :: test_collection
2023-07-21 16:05:21.223 INFO     :: ITEM_ID 0
2023-07-21 16:05:21.228 ERROR    :: Exception in callback _task_done(<Task finishe... expression")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43
handle: <Handle _task_done(<Task finishe... expression")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43>
Traceback (most recent call last):

  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 633, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x4002b3c9d0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 600, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x4002b3e4d0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 1896, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x4002a95f30>
    └ <Handle _task_done(<Task finishe... expression")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
> File "/usr/local/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle _task_done(<Task finishe... expression")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle _task_done(<Task finishe... expression")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle _task_done(<Task finishe... expression")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py", line 47, in _task_done
    raise exc
          └ TypeError("object AsyncIOMotorCursor can't be used in 'await' expression")

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': 0, 'skip': 10, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046de440>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 111, in _read
    cursor = await db.test_collection.find()
                   └ AsyncIOMotorDatabase(Database(MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=False, driver=...

TypeError: object AsyncIOMotorCursor can't be used in 'await' expression
2023-07-21 16:05:21.277 ERROR    :: Task exception was never retrieved
future: <Task finished name='Task-19' coro=<consumer() done, defined at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py:31> exception=TypeError("object AsyncIOMotorCursor can't be used in 'await' expression")>
Traceback (most recent call last):

> File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py", line 37, in consumer
    return await create_task(callback, message)
                 │           │         └ IncomingMessage:{'app_id': None,
                 │           │            'body_size': 95,
                 │           │            'cluster_id': '',
                 │           │            'consumer_tag': 'ctag1.04c883a2e9d04ca9ae2b4016a353920...
                 │           └ <bound method MongostorageApp._process_message of <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>>
                 └ <function create_task at 0x40031d4820>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': 0, 'skip': 10, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046de440>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 111, in _read
    cursor = await db.test_collection.find()
                   └ AsyncIOMotorDatabase(Database(MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=False, driver=...

TypeError: object AsyncIOMotorCursor can't be used in 'await' expression
2023-07-21 16:08:12.735 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:08:21.268 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:08:32.555 INFO     :: test_collection
2023-07-21 16:08:32.557 INFO     :: ITEM_ID 0
2023-07-21 16:08:32.569 ERROR    :: Exception in callback _task_done(<Task finishe... expression")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43
handle: <Handle _task_done(<Task finishe... expression")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43>
Traceback (most recent call last):

  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 633, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x4002b3c9d0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 600, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x4002b3e4d0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 1896, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x4002a95f30>
    └ <Handle _task_done(<Task finishe... expression")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
> File "/usr/local/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle _task_done(<Task finishe... expression")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle _task_done(<Task finishe... expression")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle _task_done(<Task finishe... expression")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py", line 47, in _task_done
    raise exc
          └ TypeError("object AsyncIOMotorCursor can't be used in 'await' expression")

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': 0, 'skip': 10, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046de440>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 111, in _read
    cursor = await collection.find()
                   │          └ <function AgnosticCollection.find at 0x400368c310>
                   └ AsyncIOMotorCollection(Collection(Database(MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=F...

TypeError: object AsyncIOMotorCursor can't be used in 'await' expression
2023-07-21 16:08:32.616 ERROR    :: Task exception was never retrieved
future: <Task finished name='Task-19' coro=<consumer() done, defined at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py:31> exception=TypeError("object AsyncIOMotorCursor can't be used in 'await' expression")>
Traceback (most recent call last):

> File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py", line 37, in consumer
    return await create_task(callback, message)
                 │           │         └ IncomingMessage:{'app_id': None,
                 │           │            'body_size': 95,
                 │           │            'cluster_id': '',
                 │           │            'consumer_tag': 'ctag1.d4419bec90f0491c9a754a3fc8fb090...
                 │           └ <bound method MongostorageApp._process_message of <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>>
                 └ <function create_task at 0x40031d4820>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': 0, 'skip': 10, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046de440>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 111, in _read
    cursor = await collection.find()
                   │          └ <function AgnosticCollection.find at 0x400368c310>
                   └ AsyncIOMotorCollection(Collection(Database(MongoClient(host=['mongodb:27017'], document_class=dict, tz_aware=False, connect=F...

TypeError: object AsyncIOMotorCursor can't be used in 'await' expression
2023-07-21 16:10:17.057 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:10:25.651 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:10:26.542 INFO     :: test_collection
2023-07-21 16:10:26.546 INFO     :: ITEM_ID 0
2023-07-21 16:10:26.556 ERROR    :: Exception in callback _task_done(<Task finishe...t: 'length'")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43
handle: <Handle _task_done(<Task finishe...t: 'length'")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43>
Traceback (most recent call last):

  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 633, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x4002b3c9d0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 600, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x4002b3e4d0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 1896, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x4002a95f30>
    └ <Handle _task_done(<Task finishe...t: 'length'")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
> File "/usr/local/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle _task_done(<Task finishe...t: 'length'")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle _task_done(<Task finishe...t: 'length'")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle _task_done(<Task finishe...t: 'length'")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py", line 47, in _task_done
    raise exc
          └ TypeError("AgnosticBaseCursor.to_list() missing 1 required positional argument: 'length'")

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': 0, 'skip': 10, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046de440>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 112, in _read
    async for document in cursor.to_list():
                          │      └ <function AgnosticBaseCursor.to_list at 0x400368cd30>
                          └ AsyncIOMotorCursor(<pymongo.cursor.Cursor object at 0x4004764fd0>)

TypeError: AgnosticBaseCursor.to_list() missing 1 required positional argument: 'length'
2023-07-21 16:10:26.599 ERROR    :: Task exception was never retrieved
future: <Task finished name='Task-19' coro=<consumer() done, defined at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py:31> exception=TypeError("AgnosticBaseCursor.to_list() missing 1 required positional argument: 'length'")>
Traceback (most recent call last):

> File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py", line 37, in consumer
    return await create_task(callback, message)
                 │           │         └ IncomingMessage:{'app_id': None,
                 │           │            'body_size': 95,
                 │           │            'cluster_id': '',
                 │           │            'consumer_tag': 'ctag1.0ba359161e904046ab013b3a3e07396...
                 │           └ <bound method MongostorageApp._process_message of <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>>
                 └ <function create_task at 0x40031d4820>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': 0, 'skip': 10, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046de440>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 112, in _read
    async for document in cursor.to_list():
                          │      └ <function AgnosticBaseCursor.to_list at 0x400368cd30>
                          └ AsyncIOMotorCursor(<pymongo.cursor.Cursor object at 0x4004764fd0>)

TypeError: AgnosticBaseCursor.to_list() missing 1 required positional argument: 'length'
2023-07-21 16:10:49.762 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:10:58.299 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:11:04.419 INFO     :: test_collection
2023-07-21 16:11:04.422 INFO     :: ITEM_ID 0
2023-07-21 16:11:04.444 ERROR    :: Exception in callback _task_done(<Task finishe...ncio.Future")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43
handle: <Handle _task_done(<Task finishe...ncio.Future")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43>
Traceback (most recent call last):

  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 633, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x4002b3c9d0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 600, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x4002b3e4d0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 1896, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x4002a95f30>
    └ <Handle _task_done(<Task finishe...ncio.Future")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
> File "/usr/local/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle _task_done(<Task finishe...ncio.Future")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle _task_done(<Task finishe...ncio.Future")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle _task_done(<Task finishe...ncio.Future")>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py", line 47, in _task_done
    raise exc
          └ TypeError("'async for' requires an object with __aiter__ method, got _asyncio.Future")

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': 0, 'skip': 10, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046de440>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 112, in _read
    async for document in cursor.to_list(10):
                          │      └ <function AgnosticBaseCursor.to_list at 0x400368cd30>
                          └ AsyncIOMotorCursor(<pymongo.cursor.Cursor object at 0x4004764fd0>)

TypeError: 'async for' requires an object with __aiter__ method, got _asyncio.Future
2023-07-21 16:11:04.500 ERROR    :: Task exception was never retrieved
future: <Task finished name='Task-19' coro=<consumer() done, defined at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py:31> exception=TypeError("'async for' requires an object with __aiter__ method, got _asyncio.Future")>
Traceback (most recent call last):

> File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py", line 37, in consumer
    return await create_task(callback, message)
                 │           │         └ IncomingMessage:{'app_id': None,
                 │           │            'body_size': 95,
                 │           │            'cluster_id': '',
                 │           │            'consumer_tag': 'ctag1.c1a18811ac2c4917ae485f509f947f3...
                 │           └ <bound method MongostorageApp._process_message of <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>>
                 └ <function create_task at 0x40031d4820>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': 0, 'skip': 10, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046de440>
                └ <mongostorage_app_svc.MongostorageApp object at 0x40028314e0>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 112, in _read
    async for document in cursor.to_list(10):
                          │      └ <function AgnosticBaseCursor.to_list at 0x400368cd30>
                          └ AsyncIOMotorCursor(<pymongo.cursor.Cursor object at 0x4004764fd0>)

TypeError: 'async for' requires an object with __aiter__ method, got _asyncio.Future
2023-07-21 16:12:32.912 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:12:41.502 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:12:54.810 INFO     :: test_collection
2023-07-21 16:12:54.812 INFO     :: ITEM_ID 0
2023-07-21 16:12:54.995 ERROR    :: Exception in callback _task_done(<Task finishe...erializable')>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43
handle: <Handle _task_done(<Task finishe...erializable')>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43>
Traceback (most recent call last):

  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 633, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x4002b3c9d0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 600, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x4002b3e4d0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 1896, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x4002a95f30>
    └ <Handle _task_done(<Task finishe...erializable')>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
> File "/usr/local/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle _task_done(<Task finishe...erializable')>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle _task_done(<Task finishe...erializable')>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle _task_done(<Task finishe...erializable')>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py", line 47, in _task_done
    raise exc
          └ TypeError('Object of type ObjectId is not JSON serializable')

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 89, in _process_message
    body=json.dumps(res, ensure_ascii=False).encode(),
         │    │     └ [{'_id': ObjectId('64baa845442a2a29b3ee5551'), 'name': 'Alexey', 'surname': 'Zago', 'prof': 'programmer'}, {'_id': ObjectId('...
         │    └ <function dumps at 0x4002ba71c0>
         └ <module 'json' from '/usr/local/lib/python3.10/json/__init__.py'>

  File "/usr/local/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
      │          └ [{'_id': ObjectId('64baa845442a2a29b3ee5551'), 'name': 'Alexey', 'surname': 'Zago', 'prof': 'programmer'}, {'_id': ObjectId('...
      └ {}
  File "/usr/local/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ [{'_id': ObjectId('64baa845442a2a29b3ee5551'), 'name': 'Alexey', 'surname': 'Zago', 'prof': 'programmer'}, {'_id': ObjectId('...
             │    └ <function JSONEncoder.iterencode at 0x4002ba75b0>
             └ <json.encoder.JSONEncoder object at 0x400475cfa0>
  File "/usr/local/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ [{'_id': ObjectId('64baa845442a2a29b3ee5551'), 'name': 'Alexey', 'surname': 'Zago', 'prof': 'programmer'}, {'_id': ObjectId('...
           └ <_json.Encoder object at 0x400477bd00>
  File "/usr/local/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type ObjectId is not JSON serializable
2023-07-21 16:12:55.033 ERROR    :: Task exception was never retrieved
future: <Task finished name='Task-19' coro=<consumer() done, defined at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py:31> exception=TypeError('Object of type ObjectId is not JSON serializable')>
Traceback (most recent call last):

> File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/queue.py", line 37, in consumer
    return await create_task(callback, message)
                 │           │         └ IncomingMessage:{'app_id': None,
                 │           │            'body_size': 95,
                 │           │            'cluster_id': '',
                 │           │            'consumer_tag': 'ctag1.8b3cdec3e94a4c0e880c1bd5554d92d...
                 │           └ <bound method MongostorageApp._process_message of <mongostorage_app_svc.MongostorageApp object at 0x4002831510>>
                 └ <function create_task at 0x40031d4820>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 89, in _process_message
    body=json.dumps(res, ensure_ascii=False).encode(),
         │    │     └ [{'_id': ObjectId('64baa845442a2a29b3ee5551'), 'name': 'Alexey', 'surname': 'Zago', 'prof': 'programmer'}, {'_id': ObjectId('...
         │    └ <function dumps at 0x4002ba71c0>
         └ <module 'json' from '/usr/local/lib/python3.10/json/__init__.py'>

  File "/usr/local/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
      │          └ [{'_id': ObjectId('64baa845442a2a29b3ee5551'), 'name': 'Alexey', 'surname': 'Zago', 'prof': 'programmer'}, {'_id': ObjectId('...
      └ {}
  File "/usr/local/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ [{'_id': ObjectId('64baa845442a2a29b3ee5551'), 'name': 'Alexey', 'surname': 'Zago', 'prof': 'programmer'}, {'_id': ObjectId('...
             │    └ <function JSONEncoder.iterencode at 0x4002ba75b0>
             └ <json.encoder.JSONEncoder object at 0x400475cfa0>
  File "/usr/local/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ [{'_id': ObjectId('64baa845442a2a29b3ee5551'), 'name': 'Alexey', 'surname': 'Zago', 'prof': 'programmer'}, {'_id': ObjectId('...
           └ <_json.Encoder object at 0x400477bd00>
  File "/usr/local/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type ObjectId is not JSON serializable
2023-07-21 16:16:53.550 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:16:53.601 INFO     :: test_collection
2023-07-21 16:16:53.603 INFO     :: ITEM_ID 0
2023-07-21 16:16:53.740 ERROR    :: Exception in callback _task_done(<Task finishe...dStateError()>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43
handle: <Handle _task_done(<Task finishe...dStateError()>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py:43>
Traceback (most recent call last):

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 71, in _process_message
    res = await self._read(mes)
                │    │     └ {'action': 'read', 'collection_id': 'test_collection', 'item_id': 0, 'skip': 10, 'limit': None}
                │    └ <function MongostorageApp._read at 0x40046ca440>
                └ <mongostorage_app_svc.MongostorageApp object at 0x4002831600>

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 112, in _read
    async for document in cursor:
                          └ AsyncIOMotorCursor(<pymongo.cursor.Cursor object at 0x4004770fd0>)

  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/motor/core.py", line 1288, in next
    if self.alive and (self._buffer_size() or await self._get_more()):
       │    │          │    │                       │    └ <function AgnosticBaseCursor._get_more at 0x400368ca60>
       │    │          │    │                       └ AsyncIOMotorCursor(<pymongo.cursor.Cursor object at 0x4004770fd0>)
       │    │          │    └ <function AgnosticBaseCursor._buffer_size at 0x400368d000>
       │    │          └ AsyncIOMotorCursor(<pymongo.cursor.Cursor object at 0x4004770fd0>)
       │    └ <property object at 0x40036ae5c0>
       └ AsyncIOMotorCursor(<pymongo.cursor.Cursor object at 0x4004770fd0>)

asyncio.exceptions.CancelledError


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 633, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x4002b3c9d0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 600, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x4002b3e4d0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 1896, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x4002a95f30>
    └ <Handle _task_done(<Task finishe...dStateError()>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
> File "/usr/local/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle _task_done(<Task finishe...dStateError()>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle _task_done(<Task finishe...dStateError()>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle _task_done(<Task finishe...dStateError()>) at /usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/t...
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/tools.py", line 47, in _task_done
    raise exc
          └ ChannelInvalidStateError()

  File "/usr/src/mongostorage_app/src/mongostorage/app/mongostorage_app_svc.py", line 54, in _process_message
    async with message.process(ignore_processed=True):
               │       └ <function IncomingMessage.process at 0x40032175b0>
               └ IncomingMessage:{'app_id': None,
                  'body_size': 95,
                  'cluster_id': '',
                  'consumer_tag': 'ctag1.224598fb40e042a1ac981c0e6e6dd9e...

  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/message.py", line 605, in __aexit__
    if not self.message.channel.is_closed:
           │    │       └ <property object at 0x400321c270>
           │    └ IncomingMessage:{'app_id': None,
           │       'body_size': 95,
           │       'cluster_id': '',
           │       'consumer_tag': 'ctag1.224598fb40e042a1ac981c0e6e6dd9e...
           └ <aio_pika.message.ProcessContext object at 0x4004770d30>
  File "/usr/src/mongostorage_app/.venv/lib/python3.10/site-packages/aio_pika/message.py", line 414, in channel
    raise ChannelInvalidStateError
          └ <class 'aiormq.exceptions.ChannelInvalidStateError'>

aiormq.exceptions.ChannelInvalidStateError
2023-07-21 16:17:02.470 INFO     :: Связь с AMQP сервером установлена.
2023-07-21 16:17:02.479 INFO     :: test_collection
2023-07-21 16:17:02.480 INFO     :: ITEM_ID 0
2023-07-21 16:17:09.005 INFO     :: test_collection
2023-07-21 16:17:09.009 INFO     :: ITEM_ID 0
2023-08-01 15:50:02.410 INFO     :: Связь с AMQP сервером установлена.
2023-08-01 15:50:11.743 INFO     :: Связь с AMQP сервером установлена.
2023-08-01 16:07:41.427 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:07:41.459 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:07:41.466 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:07:46.515 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:07:46.518 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno -2] Name or service not known. Reconnecting after 5 seconds.
2023-08-01 16:07:51.560 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:07:51.569 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno -2] Name or service not known. Reconnecting after 5 seconds.
2023-08-01 16:07:56.614 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:07:56.620 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno -2] Name or service not known. Reconnecting after 5 seconds.
2023-08-01 16:08:01.653 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:08:01.658 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno -2] Name or service not known. Reconnecting after 5 seconds.
2023-08-01 16:08:06.694 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:08:06.699 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno -2] Name or service not known. Reconnecting after 5 seconds.
2023-08-01 16:08:11.730 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:08:11.736 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno -2] Name or service not known. Reconnecting after 5 seconds.
2023-08-01 16:08:16.774 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:08:16.784 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno -2] Name or service not known. Reconnecting after 5 seconds.
2023-08-01 16:08:21.819 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:08:21.824 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno -2] Name or service not known. Reconnecting after 5 seconds.
2023-08-01 16:08:26.873 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:08:26.879 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno -2] Name or service not known. Reconnecting after 5 seconds.
2023-08-01 16:08:31.913 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:08:31.917 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno -2] Name or service not known. Reconnecting after 5 seconds.
2023-08-01 16:08:36.929 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:08:36.931 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:08:41.961 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:08:41.969 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:08:47.002 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:08:47.009 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:08:52.022 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:08:52.025 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:08:57.047 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:08:57.052 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:09:02.086 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:09:02.091 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:09:07.125 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:09:07.139 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:09:12.181 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:09:12.189 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:09:17.213 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:09:17.223 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:09:22.244 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:09:22.250 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:09:27.271 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:09:27.275 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:09:32.291 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:09:32.299 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:09:37.317 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
2023-08-01 16:09:37.321 WARNING  :: Connection attempt to "amqp://crwl:******@rabbitmq/" failed: [Errno 111] Connect call failed ('172.18.0.3', 5672). Reconnecting after 5 seconds.
2023-08-01 16:11:22.307 ERROR    :: Unexpected connection close from remote "amqp://crwl:******@rabbitmq:5672/", Connection.Close(reply_code=320, reply_text="CONNECTION_FORCED - broker forced connection closure with reason 'shutdown'")
NoneType: None
2023-08-01 16:11:57.370 INFO     :: Связь с AMQP сервером установлена.
2023-08-01 16:12:06.974 INFO     :: Связь с AMQP сервером установлена.
2023-08-01 16:14:23.774 ERROR    :: Unexpected connection close from remote "amqp://crwl:******@rabbitmq:5672/", Connection.Close(reply_code=320, reply_text="CONNECTION_FORCED - broker forced connection closure with reason 'shutdown'")
NoneType: None
2023-08-08 15:59:34.749 INFO     :: Связь с AMQP сервером установлена.
2023-08-08 15:59:44.944 INFO     :: Связь с AMQP сервером установлена.
2023-08-08 16:03:09.169 ERROR    :: Unexpected connection close from remote "amqp://crwl:******@rabbitmq:5672/", Connection.Close(reply_code=320, reply_text="CONNECTION_FORCED - broker forced connection closure with reason 'shutdown'")
NoneType: None
2023-08-08 16:03:09.231 INFO     :: Connection to amqp://crwl:******@rabbitmq/ closed. Reconnecting after 5 seconds.
